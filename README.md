# YCY-Control
主要针对役次元蓝牙设备开发的控制软件，目前支持役次元杯子2.0，1.0理论上可用。役次元其余设备在逐渐开发中，未来计划将较火的其他设备也进行接入。
>>>>>>> 50346e774110c52213668fb968dbb7ea7faaf430

<<<<<<< HEAD
# YCY 设备控制项目

本项目提供了对 YCY-FJB 系列蓝牙设备的控制功能，目前支持杯子2.0，包括基础控制和随机控制两种模式，支持命令行和图形界面操作。

## 项目结构

```
YCY Control/
├── core/                 # 核心功能模块
│   ├── __init__.py       # 包初始化文件
│   ├── ycy_fjb.py        # 蓝牙设备通信核心
│   └── random_controller.py  # 随机控制逻辑
├── utils/                # 通用工具模块
│   ├── __init__.py       # 包初始化文件
│   ├── config.py         # 配置管理
│   └── logger.py         # 日志管理
├── ControlPanel.py       # 命令行控制面板
├── YCYControlGUI.py      # 图形界面控制面板
├── README.md             # 项目说明文档
└── requirements.txt      # 依赖包声明
```

## 功能说明

### 1. 基础控制模块 (core/ycy_fjb.py)
- 设备扫描与连接管理
- 蓝牙命令发送与接收
- 马达速度控制（A/B/C通道）
- 马达模式控制（A/B/C通道）
- 设备信息与电池电量获取
- 异步通知处理
- 实时电池电量更新回调

### 2. 随机控制模块 (core/random_controller.py)
- 速率随机控制模式（speed）
- 模式随机控制模式（mode）
- 定时循环控制（自动切换状态）
- 不定时模式（执行一次后保持状态）
- B通道自动放气逻辑
- 通道上下限参数验证

### 3. 命令行控制面板 (ControlPanel.py)
- 提供交互式命令行界面
- 整合基础控制与随机控制功能
- 设备连接与状态管理
- 设备信息查询

### 4. 图形界面控制面板 (YCYControlGUI.py)
- 专业交互式图形界面
- 实时电池电量更新与可视化指示器
- 连接进度动画
- 基础控制（速率控制和内建模式控制）
- 随机控制（随机速率模式和随机内建模式）
- 配置暂存与批量应用
- 通道名称本地化（旋转伸缩、吮吸、震动）
- 智能控制逻辑（解决速率和模式控制冲突）
- 临时停止（寸止）功能
- 详细的使用说明区域

## 安装与依赖

### 依赖包
- Python 3.7+
- bleak (蓝牙通信库)
- tkinter (图形界面库，Python标准库)
- asyncio (异步编程库，Python标准库)
- threading (线程管理库，Python标准库)

### 安装方法
```bash
# 安装依赖
pip install bleak

# 克隆或下载项目到本地
```

## 使用方法

### 1. 运行命令行控制面板
```bash
python ControlPanel.py
```

### 2. 运行图形界面控制面板
```bash
python YCYControlGUI.py
```

### 3. 命令行控制面板使用
在控制面板中选择相应功能：
- **基础控制**：输入命令设置速度和模式
  - 设置速度：`speed A 10` （设置A通道速度为10）
  - 设置模式：`mode B 3` （设置B通道模式为3）
  - 返回主菜单：`back`

- **随机控制**：启动随机控制模式
  - 启动速度随机控制：`speed`
  - 启动模式随机控制：`mode`
  - 返回主菜单：`back`

- **查看设备信息**：显示设备的详细信息和电池电量

### 4. 图形界面控制面板使用

#### 4.1 设备连接
- 点击 "连接设备" 按钮，系统会自动搜索并连接设备
- 连接过程中会显示进度动画
- 连接成功后，右上角会显示设备名称

#### 4.2 基础控制
- **速率控制**：设置各通道的运行速度
  - 旋转伸缩（A通道）：0-20
  - 吮吸（B通道）：0-20
  - 震动（C通道）：0-20

- **内建模式控制**：设置各通道的内建模式
  - 所有通道：0-7（0=关闭）

- **控制逻辑**：
  - 同一个通道，速率控制和模式控制只发一个值给机器

- **操作流程**：
  1. 在输入框中填写需要的数值
  2. 点击对应通道的 "设置" 按钮暂存配置
  3. 点击 "启动" 按钮应用配置
  4. 点击 "全部停止" 按钮停止所有控制

#### 4.3 随机控制
- **模式选择**：
  - 随机速率模式：随机设置各通道的运行速度
  - 随机内建模式：随机设置各通道的内建模式

- **范围设置**：
  - 设置各通道的最小值和最大值（默认：0-20）

- **操作流程**：
  1. 选择随机模式
  2. 设置各通道的范围
  3. 点击 "启动随机控制" 按钮开始
  4. 点击 "停止随机控制" 按钮停止

#### 4.4 设备信息
- 点击 "查看设备信息" 按钮，系统会显示设备的详细信息
- 电池电量会实时更新，并在界面上显示可视化指示器
  - 绿色：电量 > 30%
  - 橙色：电量 ≤ 30%
  - 红色：电量 ≤ 10%

#### 4.5 临时停止（寸止）功能
- **位置**：设备连接模块中，居中放置的浅蓝色按钮
- **功能**：点击后临时停止设备,以及彩蛋
- **特点**：
  - 适用于基础控制和随机控制模式
  - 随机模式下会先停止随机控制，暂停结束后自动恢复

#### 4.6 界面说明
- 右上角：显示设备名称（不可编辑）
- 左侧：基础控制区域（速率控制和内建模式控制）
- 右侧：随机控制和设备信息区域
- 底部：使用说明区域
- 设备连接模块：包含临时停止（寸止）按钮

## 注意事项

1. **设备连接**：确保蓝牙设备已开启，且与电脑在有效范围内。
2. **参数范围**：
   - 旋转伸缩（A通道）速度：0-40（0=关闭, 1-20=正转, 21-40=反转）(图形界面反转会自动，不需要设置20以上)
   - 吮吸（B通道）速度：0-20（0=放气, 1=不吸不放, 2-20=吸气）
   - 震动（C通道）速度：0-20（震动强度）
   - 所有通道模式：0-7（0=关闭）
3. **异步操作**：所有设备操作都是异步的，使用时需要注意异步编程规范。
4. **安全使用**：吮吸（B通道）吸气后会自动放气，避免持续吸气造成生理性损伤。
5. **GUI界面**：
   - 图形界面支持实时电池电量更新和连接进度动画
   - 基础控制采用配置暂存机制，点击"设置"按钮暂存配置，点击"启动"按钮应用配置
   - 同一个通道，速率控制和模式控制只发一个值给机器，避免冲突
6. **随机控制**：
   - 随机速率模式的默认范围为0-20
   - 确保设置的范围在有效参数范围内，否则会提示错误
7. **电池电量**：
   - 电池电量会实时更新，当电量低于30%时会显示橙色，低于10%时会显示红色
   - 建议在电量低时及时充电，以避免设备突然断电

## 扩展与开发

### 添加新功能
1. 在 `core/` 目录下创建新的功能模块
2. 在 `core/__init__.py` 中导出新功能
3. 在 `ControlPanel.py` 中添加相应的交互逻辑

### 自定义配置
1. 使用 `utils/config.py` 中的 `ConfigManager` 类管理配置
2. 配置文件会保存在 `config/` 目录下

### 日志管理
1. 使用 `utils/logger.py` 中的 `get_logger` 函数获取日志记录器
2. 日志文件会保存在 `logs/` 目录下

## 故障排查

1. **设备连接失败**：
   - 检查设备是否开启蓝牙
   - 检查设备名称是否正确（默认：YCY-FJB-03）
   - 检查电脑蓝牙是否正常工作

2. **命令执行失败**：
   - 检查设备是否已连接
   - 检查命令格式是否正确
   - 检查参数是否在有效范围内

3. **随机控制异常**：
   - 检查上下限参数是否正确
   - 检查设备是否支持所选模式

## 版本历史

- v1.0.2：
  - 添加了临时停止（寸止）功能
  - 实现了令人愉悦的彩蛋
  - 优化了随机模式下的暂停逻辑，确保暂停期间随机控制完全停止
  - 新增浅蓝色、较大尺寸的临时停止按钮，居中放置在设备连接模块

- v1.0.1：
  - 添加了图形界面控制面板（YCYControlGUI.py）
  - 实现了实时电池电量更新与可视化指示器
  - 添加了连接进度动画
  - 优化了基础控制逻辑，解决了速率控制和模式控制的冲突问题
  - 实现了配置暂存与批量应用机制
  - 对通道名称进行了本地化处理（旋转伸缩、吮吸、震动）
  - 添加了详细的使用说明区域
  - 更新了随机速率模式的默认值为0-20

- v1.0.0：初始版本，包含基础控制和随机控制功能

## 许可证

本项目仅供个人学习和研究使用，不得用于商业用途。
=======
